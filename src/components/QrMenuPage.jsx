import { useState, useEffect } from "react";
import { collection, getDocs, query, orderBy } from "firebase/firestore";
import { db } from "../firebase";
import "../styles/QrMenuPage.css";
import Nav from "./Nav/Nav";
import ScrollToTop from "../components/ScrollToTop";

/* ----- Օգնական ֆունկցիա slugify-ի համար ----- */
function slugify(text) {
  return text
    .toString()
    .toLowerCase()
    .trim()
    .replace(/\s+/g, "-")
    .replace(/[^\p{L}\p{N}-]+/gu, "")
    .replace(/--+/g, "-");
}

/* ----- MenuSection Subcomponent ----- */
function MenuSection({ section, index, onImageClick }) {
  const sectionId = slugify(section.category);

  return (
    <div
      id={sectionId}
      className="qr-menu-section fade-in"
      style={{ animationDelay: `${index * 100}ms` }}
    >
      <h3 className="qr-menu-section-title">
        {/* <img src="/icon.png" alt="Default Icon" className="section-icon" /> */}
        {section.category}
        {section.iconUrl && (
          <img
            src={section.iconUrl}
            alt="Category Extra Icon"
            className="section-icon-iconUrl"
            style={{ marginLeft: "4px" }}
          />
        )}
      </h3>
      <ul className="qr-menu-items">
        {section.items?.map((item, idx) => (
          <li key={idx} className="qr-menu-item">
            {item.imageUrl && (
              <img
                src={item.imageUrl}
                alt={item.nameEn || item.nameHy || "Menu item image"}
                className="qr-menu-item-image"
                onClick={() => onImageClick(item.imageUrl)}
                style={{ cursor: "zoom-in" }}
              />
            )}
            <div className="qr-menu-item-text">
              <div className="qr-menu-item-line">
                <span className="item-name-block">
                  {item.nameEn && (
                    <span className="item-name-en">{item.nameEn}</span>
                  )}
                  {item.nameHy && (
                    <span className="item-name-hy">{item.nameHy}</span>
                  )}
                </span>
                <span className="dots"></span>
                <strong className="item-price">{item.price} AMD</strong>
              </div>
            </div>
          </li>
        ))}
      </ul>
    </div>
  );
}

/* ----- Main Component ----- */
export default function QrMenuPage() {
  const [menu, setMenu] = useState([]);
  const [loading, setLoading] = useState(true);
  const [previewImage, setPreviewImage] = useState(null);

  const categories = [...new Set(menu.map((s) => s.category))];
  const categorySlugs = categories.map((cat) => ({
    name: cat,
    slug: slugify(cat),
  }));

  useEffect(() => {
    const fetchMenu = async () => {
      try {
        const q = query(collection(db, "menu"), orderBy("order"));
        const snapshot = await getDocs(q);
        const data = snapshot.docs.map((doc) => ({
          id: doc.id,
          ...doc.data(),
        }));
        setMenu(data);
      } catch (error) {
        console.error("Չհաջողվեց բեռնել մենյուն։", error);
      } finally {
        setLoading(false);
      }
    };

    fetchMenu();
  }, []);

  return (
    <div className="qr-menu-page">
      <div className="qr-menu-hero"></div>

      <Nav categories={categorySlugs} />

      {loading ? (
        <div className="loader" aria-label="Մենյուն բեռնվում է...">
          <span>Մենյուն բեռնվում է...</span>
        </div>
      ) : menu.length === 0 ? (
        <p className="empty-state">
          Մենյուն դեռ դատարկ է։ Խնդրում ենք փորձել ավելի ուշ կամ կապվել մեզ հետ։
        </p>
      ) : (
        menu.map((section, index) => (
          <div key={section.id}>
            <MenuSection
              section={section}
              index={index}
              onImageClick={setPreviewImage}
            />
           {index === 0 && (
   <div className="after-first-category-text">
    <img src="/bg2.png" alt="Coffee Icon" />
    
   <p>
   {/* <svg width="97" height="35" viewBox="0 0 97 35" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_66_64)">
<path d="M0.946732 30.8458L2.07597 2.49133L94.3024 7.66394L95.6826 28.7859C90.2816 29.8849 84.8807 30.9896 79.4798 32.0886C53.3021 31.6743 27.1244 31.26 0.946732 30.8458Z" fill="white"/>
<path d="M0.0228128 17.5604L0.0456256 34.9942L48.5228 34.931L97 34.8677L96.9772 17.4338L96.9544 0L48.4772 0.0632911L0 0.126582L0.0228128 17.5604ZM13.6706 4.79286C13.7903 4.82739 14.4291 5.30495 15.1078 5.86306C15.8492 6.4672 16.3796 6.85846 16.4651 6.85846C16.545 6.85846 16.8301 6.71461 17.0982 6.53625C17.7369 6.11047 19.4878 4.98274 19.6703 4.87917C19.8186 4.78711 20.2635 4.76985 20.4517 4.84465C20.6627 4.93095 22.7501 6.73188 22.8698 6.93326C22.9896 7.12313 22.9953 7.41657 23.001 13.2911V19.4476L23.2805 19.7468C23.5941 20.0921 23.7823 20.1208 24.0732 19.8792C24.4211 19.58 24.615 19.6433 25.2252 20.2301L25.7613 20.7537V21.099C25.7613 21.2888 25.7271 21.5017 25.6986 21.5765C25.6074 21.7434 22.3851 24.4764 22.1797 24.5512C21.9687 24.6318 21.6607 24.626 21.4897 24.5339C21.3186 24.4476 19.0601 22.2612 18.9004 22.0368C18.7977 21.893 18.7863 21.3579 18.7464 16.0184L18.7065 10.1611L18.3472 9.79286C18.1134 9.55696 17.9423 9.43038 17.8339 9.43038C17.6457 9.43038 16.7503 9.98274 16.6134 10.1784C16.5279 10.2992 16.5165 11.0357 16.5222 15.4315C16.5279 21.0932 16.4937 20.6847 16.9784 21.145C17.4461 21.5995 17.4917 22.1289 17.0982 22.5316C16.9784 22.6467 16.4024 23.153 15.8207 23.6536L14.7542 24.557H14.3949C14.0584 24.557 14.0128 24.5397 13.6934 24.2463C13.066 23.6709 12.3303 22.9402 12.2505 22.8078C12.1934 22.71 12.1649 21.0587 12.1307 16.4212L12.0908 10.1669L11.7315 9.79862C11.4976 9.56272 11.3266 9.43613 11.2182 9.43613C11.0357 9.43613 10.1175 10 9.9863 10.1956C9.90646 10.2992 9.89505 11.2255 9.90075 15.6444C9.90646 20.5869 9.90075 20.9781 9.79809 21.1795C9.69544 21.3579 8.23542 22.5604 6.0625 24.2463C5.61195 24.5972 5.30397 24.6548 4.94467 24.4707C4.76217 24.3728 3.17668 22.5949 3.09113 22.3993C3.01129 22.1922 3.0398 21.7779 3.14246 21.6053C3.19949 21.5075 3.72419 21.0472 4.30591 20.5926C4.88194 20.1381 5.42374 19.6663 5.50929 19.5397L5.65187 19.3211V14.5109C5.64046 11.87 5.61765 9.66053 5.60054 9.60299C5.54351 9.45339 5.42374 9.47066 5.05874 9.7008C4.6424 9.95972 4.35154 10.0058 4.05497 9.86766C3.7527 9.72382 2.75464 8.50978 2.69191 8.20483C2.62347 7.91715 2.70902 7.57767 2.90293 7.40506C2.98848 7.33026 3.87818 6.71461 4.87623 6.03567C6.5986 4.87917 6.72977 4.80437 7.01493 4.80437C7.36853 4.80437 7.3172 4.76985 8.69738 5.97238C9.38176 6.57077 9.74677 6.84695 9.84942 6.84695C9.94067 6.84695 10.5908 6.46145 11.3893 5.93211C12.7524 5.03452 13.2599 4.72957 13.3911 4.72957C13.4253 4.72957 13.5565 4.75834 13.6649 4.78711L13.6706 4.79286ZM41.833 4.85616C41.9299 4.90794 42.4204 5.40276 42.928 5.95512L43.8405 6.96203L43.8804 13.2163L43.9203 19.4764L44.1827 19.7468C44.4849 20.0633 44.7074 20.0921 44.9868 19.8446C45.3119 19.5685 45.4887 19.6203 46.059 20.1496C46.6408 20.6847 46.7605 20.9436 46.6236 21.3694C46.5495 21.588 46.2757 21.8469 44.85 23.0552C43.9203 23.8435 43.0991 24.5109 43.0192 24.5282C42.7911 24.5857 42.4945 24.5685 42.3291 24.4822C42.2493 24.4361 41.6219 23.8377 40.9376 23.1473C40.2475 22.4626 39.6829 21.8987 39.6772 21.8987C39.6714 21.893 39.6429 19.1139 39.6144 15.7192C39.5916 11.7837 39.546 9.50518 39.5061 9.43038C39.4718 9.37284 39.2494 9.10817 39.0156 8.84925C38.2285 7.97468 38.0974 7.64672 38.3198 7.20944C38.4167 7.02532 40.8121 4.89068 41.0231 4.80437C41.2284 4.72382 41.6334 4.74684 41.8216 4.84465L41.833 4.85616ZM93.8176 10.2992C94.3651 10.6444 94.5476 11.3694 94.2168 11.9505C93.7777 12.7388 92.5743 12.7848 92.0838 12.0311C91.331 10.8803 92.6428 9.57422 93.8176 10.2992ZM32.1375 10.4373C32.3485 10.5581 36.0271 14.4304 36.1469 14.672C36.1925 14.7583 36.221 15.5754 36.221 17.0886C36.221 19.672 36.2096 19.603 36.7286 20.1151L37.0537 20.4315L37.3103 20.2589C37.5156 20.1151 37.6183 20.0863 37.8293 20.1151C38.0517 20.1496 38.1544 20.2186 38.5308 20.6272C38.7646 20.8861 38.9814 21.1853 39.0042 21.2888C39.084 21.6974 38.9928 21.7952 37.2248 23.0667C36.3009 23.7342 35.4568 24.3498 35.3598 24.4361C35.2173 24.557 35.0918 24.5857 34.818 24.5915C34.4644 24.5915 34.4587 24.5915 33.8656 24.0449C32.9417 23.2048 32.7592 23.0782 32.5482 23.0782C32.3714 23.0782 31.4702 23.5961 30.2155 24.4131C29.8163 24.672 29.3886 24.672 29.0806 24.4189C28.2422 23.7227 26.8735 22.4626 26.8107 22.3188C26.7594 22.1979 26.7309 21.5938 26.7309 20.397C26.7309 18.9586 26.748 18.6133 26.8278 18.4465C26.902 18.3084 27.478 17.8826 28.7897 16.9965C29.8905 16.2543 30.6604 15.6904 30.6889 15.6156C30.706 15.5408 30.6946 15.4085 30.649 15.3337C30.5235 15.0806 29.5882 14.16 29.457 14.16C29.3373 14.16 28.2479 14.7814 27.9115 15.0345C27.6149 15.2589 27.1586 15.1669 26.8906 14.8389C26.4115 14.2463 26.3146 13.9586 26.4685 13.6249C26.5085 13.5328 27.3925 12.9287 28.824 12.0196C30.0787 11.2198 31.1965 10.5121 31.3163 10.4488C31.59 10.2992 31.8752 10.2934 32.1318 10.443L32.1375 10.4373ZM52.9599 10.4545C53.2508 10.6041 57.2886 14.7296 57.3343 14.9137C57.3514 15.0058 57.3628 16.5247 57.3571 18.2911C57.34 21.3751 57.3343 21.5132 57.2088 21.6456C57.146 21.7261 55.9712 22.4338 54.6195 23.2163C52.5379 24.4074 52.1158 24.6318 51.8934 24.6318C51.7508 24.6318 51.5797 24.6145 51.5113 24.5857C51.3231 24.5109 47.5247 21.3406 47.3765 21.122L47.2282 20.9148V17.4051C47.2168 14.183 47.2282 13.8838 47.3365 13.7112C47.4107 13.5903 48.3232 12.9344 49.8345 11.939C52.0132 10.4948 52.247 10.3567 52.5036 10.3567C52.6633 10.3567 52.8629 10.397 52.9599 10.4488V10.4545ZM78.3848 10.5063C78.9209 10.9551 81.8238 13.6651 81.9264 13.8147C82.0405 13.9758 82.0462 14.4246 82.0519 20.702C82.0576 25.6904 82.0405 27.4626 81.9835 27.5892C81.9321 27.7043 81.6071 27.9402 80.9569 28.3314C80.4322 28.6421 79.3657 29.2865 78.5901 29.7468C77.0958 30.6444 76.9361 30.7077 76.554 30.5063C76.3316 30.3855 72.9268 27.1404 72.8698 26.9965C72.7899 26.8009 72.8298 26.3003 72.9325 26.145C72.9895 26.0529 73.2177 25.8688 73.4401 25.7365C73.6568 25.6041 74.1188 25.3049 74.4724 25.0748C75.0028 24.7238 75.1453 24.6605 75.3906 24.6548C75.7442 24.6548 75.8639 24.7353 76.708 25.5236C77.4266 26.2025 77.6148 26.2888 77.8259 26.0414C77.9171 25.9436 77.9285 25.7998 77.9171 25.1036C77.8943 24.1715 77.8487 24.1082 77.4494 24.4131C77.0103 24.7526 77.016 24.7583 74.5408 22.8884C72.9268 21.6686 72.2652 21.1277 72.1968 20.9839C72.1112 20.8055 72.0998 20.2589 72.0941 17.3475C72.0941 14.2175 72.1055 13.9068 72.2082 13.7054C72.2994 13.5213 72.7728 13.2106 74.9343 11.8987C77.3525 10.4373 77.5749 10.3165 77.8601 10.3165C78.0939 10.3165 78.2137 10.3567 78.3848 10.4948V10.5063ZM89.814 10.4085C90.0877 10.5524 94.0743 14.6087 94.1541 14.8216C94.194 14.9425 94.2225 16.1277 94.2225 18.1588C94.2225 21.1105 94.2225 21.3234 94.1028 21.5075C94.0115 21.6686 93.3956 22.0483 91.4907 23.1473C89.3577 24.3728 88.9585 24.5857 88.7304 24.5857C88.5821 24.5857 88.3939 24.5512 88.3197 24.5052C88.0004 24.3326 84.2305 21.1507 84.1564 20.9896C84.0994 20.8631 84.0766 19.8907 84.0708 17.3533C84.0708 14.4534 84.0823 13.855 84.1621 13.6997C84.2191 13.5788 84.6811 13.2278 85.4852 12.6927C86.1582 12.244 87.2361 11.5305 87.8863 11.099C88.9357 10.397 89.084 10.3165 89.3463 10.3165C89.506 10.3165 89.7113 10.3567 89.814 10.4085ZM61.9995 10.9264C62.2732 11.2083 62.701 11.6571 62.9462 11.916C63.2542 12.2497 63.431 12.3993 63.545 12.3993C63.6591 12.3993 63.9728 12.1404 64.6058 11.5305C65.1077 11.0529 65.6039 10.6099 65.7122 10.5409C65.929 10.4028 66.2369 10.3797 66.5107 10.4891C66.7217 10.5696 69.8414 13.6594 69.9782 13.9241C70.0581 14.0679 70.0695 14.6893 70.0752 17.4626C70.0752 20.4833 70.0923 20.8285 70.1836 20.8688C70.2406 20.8861 70.3661 20.8516 70.4687 20.7768C70.7824 20.5524 70.9592 20.5984 71.4896 21.0817C71.9801 21.5305 72.077 21.6743 72.0086 21.893C71.963 22.0426 68.6551 24.5282 68.3642 24.626C67.9707 24.7641 67.697 24.6087 66.8187 23.7284C66.3738 23.2911 65.9689 22.8539 65.9119 22.7503C65.832 22.6064 65.8206 21.9448 65.8149 18.9356C65.8149 16.3924 65.7921 15.2474 65.7408 15.1496C65.6267 14.931 64.7484 14.0506 64.64 14.0506C64.5488 14.0506 63.8074 14.8216 63.6705 15.069C63.6135 15.1726 63.5907 16.122 63.5907 18.8608C63.5907 21.8815 63.585 22.5489 63.5051 22.6927C63.4538 22.7906 63.0203 23.2624 62.5356 23.7457C61.2409 25.0403 61.1953 25.0345 59.587 23.3947C59.0167 22.8136 58.549 22.3015 58.549 22.2497C58.5547 22.1001 58.6973 21.893 58.9197 21.7031C59.0395 21.6053 59.1593 21.4097 59.1992 21.2773C59.279 20.9781 59.2847 15.0633 59.1992 14.931C59.1593 14.8677 59.1137 14.8562 59.011 14.9194C58.703 15.0863 58.5376 15.0115 58.0015 14.4764C57.2373 13.7054 57.1803 13.8435 59.011 12.1116C59.8437 11.3234 60.6193 10.6214 60.722 10.5581C60.8303 10.4833 61.0413 10.4315 61.2067 10.4315C61.4805 10.4315 61.5204 10.4603 61.9938 10.9379L61.9995 10.9264Z" fill="#E21F26"/>
<path d="M92.7454 10.4028C91.9299 10.771 92.004 12.0599 92.8595 12.29C93.5325 12.4741 94.0914 12.0253 94.0914 11.2773C94.0914 10.5811 93.3785 10.1208 92.7454 10.4028ZM93.4982 10.6617C93.7321 10.7825 93.7606 11.168 93.5439 11.3464C93.4013 11.4615 93.3956 11.4845 93.4811 11.6053C93.5325 11.6686 93.618 11.8124 93.6693 11.9103C93.7549 12.0829 93.7549 12.0944 93.6351 12.0944C93.5553 12.0944 93.4298 11.9736 93.2986 11.7664C93.0306 11.3464 92.9165 11.3349 92.8937 11.7492C92.8823 11.9851 92.8481 12.0714 92.7625 12.0886C92.6599 12.1059 92.6428 12.0426 92.6428 11.3464V10.5811H92.9907C93.1732 10.5811 93.4013 10.6214 93.4925 10.6675L93.4982 10.6617Z" fill="#E21F26"/>
<path d="M92.9108 11.0299C92.9108 11.2083 92.9279 11.237 93.0933 11.237C93.3271 11.237 93.4526 11.1507 93.4184 11.0011C93.407 10.9091 93.3328 10.8688 93.1503 10.8573C92.9222 10.84 92.9108 10.8458 92.9108 11.0357V11.0299Z" fill="#E21F26"/>
<path d="M31.3106 17.9977L30.7631 18.412L30.7459 19.2751L30.7288 20.1496L31.1965 20.5524C31.4531 20.7711 31.6984 20.9552 31.7383 20.9552C31.7839 20.9552 31.9151 20.8976 32.0349 20.8228L32.2459 20.6905V19.2463C32.2459 17.8194 32.2459 17.7906 32.0976 17.6928C32.0178 17.6353 31.9322 17.5892 31.9094 17.5892C31.8923 17.5892 31.6242 17.7734 31.322 17.9977H31.3106Z" fill="#E21F26"/>
<path d="M51.3744 14.4419C51.3288 14.4707 51.3231 15.3913 51.3459 17.0944C51.3801 19.6088 51.3858 19.7124 51.5284 19.9655C51.8193 20.5121 52.4922 20.9897 52.9713 20.9897H53.2222L53.1994 18.4983C53.188 16.8815 53.1595 15.9034 53.1025 15.7135C52.9884 15.2935 52.5949 14.8274 52.1843 14.6318C51.7907 14.4419 51.4771 14.3671 51.3801 14.4419H51.3744Z" fill="#E21F26"/>
<path d="M76.189 14.4131C76.1434 14.4419 76.1377 15.3625 76.1605 17.0656C76.1947 19.5799 76.2004 19.6835 76.343 19.9367C76.6339 20.4833 77.3068 20.9608 77.7859 20.9608H78.0369L78.014 18.435C77.9912 15.6271 77.9684 15.5005 77.5635 15.0287C77.2441 14.6547 76.3829 14.2635 76.1947 14.4073L76.189 14.4131Z" fill="#E21F26"/>
<path d="M88.2342 14.3959C88.1886 14.4246 88.1828 15.3452 88.2057 17.0483C88.2399 19.5915 88.2456 19.6663 88.3882 19.9367C88.6904 20.5006 89.3349 20.9436 89.8311 20.9436H90.082L90.0592 19.2463C90.0193 15.7595 90.0193 15.7192 89.8596 15.4143C89.5801 14.8792 89.0725 14.4879 88.5022 14.3786C88.3996 14.3613 88.2798 14.3613 88.2399 14.3901L88.2342 14.3959Z" fill="#E21F26"/>
</g>
<defs>
<clipPath id="clip0_66_64">
<rect width="97" height="35" fill="white"/>
</clipPath>
</defs>
</svg> */}
                🎱 BlackBallPool Billiard Bar – որտեղ խաղը դառնում է հաճույք 🍸

Փնտրում ես տեղ, որտեղ կարելի է համատեղել հետաքրքիր խաղը և լավ ժամանցը❓
Այստեղ քեզ սպասում են.
✨ Մրցակցային և պրոֆեսիոնալ բիլիարդ սեղաններ
✨ Հարմարավետ մթնոլորտ՝ ընկերների հետ ժամանցի համար
✨ Բարձրորակ խմիչքներ և կոկտեյլներ
✨ Լավ երաժշտություն և անմոռանալի վայրէջքներ

Եկ ու զգա իրական խաղի ադրենալինը ․․
Քեզ և ընկերներիդ սպասում է լավագույն billiard փորձը հենց այստեղ՝ BlackBallPool-ում։
   </p>
 </div>
)}
          </div>
        ))
      )}

      {previewImage && (
        <div className="image-modal" onClick={() => setPreviewImage(null)}>
          <img
            src={previewImage}
            alt="Preview"
            className="image-modal-content"
            onClick={(e) => e.stopPropagation()}
          />
          <button
            className="image-modal-close"
            onClick={() => setPreviewImage(null)}
          >
            ×
          </button>
        </div>
      )}
      <ScrollToTop />
    </div>
  );
}
